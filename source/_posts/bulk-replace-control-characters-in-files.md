---
title: "Bulk Replace Control Characters in Files"
date: 2019-06-13T23:24:57+08:00
typora-root-url: ../../static
draft: false
categories:
  - tech
series:
tags:
  - shell
  - file
  - RSS
---
## Background

Some day, I found an error in RSS page generated by Hugo.


![image.png](1559796599860-e71c6a94-818f-48f4-baba-a80f1d76ba9b.png)


I tried to parse the source post and found an invisible character in it on GitHub.

![image.png](1559796715692-063e1faf-9883-4ce4-a3ce-ea8e576069b7.png)


I found there was a backspace character `^H` in the file and it is not the only one in the only file.


![image.png](1559796907886-63c6e956-89bb-408a-98dd-3ac1cbcab8ab.png)

## Find All Posts and Execute On Them


Basically, This is our idea that using the command `find` to get all filenames and execute the command we want on them. But don't forget to use `-print0` to send them to `xargs` by the pipline.


```shell
find ./content/posts -name "*.md" -print0 | xargs -0 wc -l
```


As we see, it works.


![image.png](1559798019861-7250e7d1-ceb5-4b66-bc9e-45f8c89d022e.png)

## Replace Invisible Character by Sed


Now we can use `sed` to replace all `^H` and `^M` in our posts. Pay attention to the character like `^H` in command, they **must** be typed with such as `ctrl+v+h`.


```shell
find ./content/posts -name "*.md" -print0 | xargs -0 sed -i '' -e 's/^H//g; s/^M//g; s/^\//g'
```


Notice that we use an empty character after `-i`  in the command instead of `sed -i -e` because of the character after the option `-i` of `sed` in Mac is used as the postfix of backup files. We need to use an empty character to tell it not to save a backup one.

## Result


After refreshing the page I opened, everything done!


![image.png](1559800359769-1ae9738b-5bcc-427e-97dd-6544ca320cf8.png)

## Reference


- [This answer on StackOverflow](https://stackoverflow.com/a/54416545/6522746) provide the idea. **But not work.**
- [This answer](https://stackoverflow.com/a/11650301/6522746) shows how to execute on all files.
- [This one](https://stackoverflow.com/a/13180357/6522746) asked how to type control characters in command line.
- The comments of [this answer](https://stackoverflow.com/a/13180336/6522746) explain how to use `sed` for replacing in Mac.



